id: org.vassalengine.vassal
runtime: org.freedesktop.Platform
runtime-version: '25.08'
sdk: org.freedesktop.Sdk
sdk-extensions:
  - org.freedesktop.Sdk.Extension.openjdk21
command: vassal
rename-desktop-file: vassal.desktop
rename-icon: VASSAL

finish-args:
  - --share=ipc
  - --socket=x11
  - --socket=pulseaudio
  - --device=dri
  - --share=network
  - --filesystem=home
  - --env=PATH=/app/jre/bin:/app/bin:/usr/bin

modules:
  - name: openjdk
    buildsystem: simple
    build-commands:
      - /usr/lib/sdk/openjdk21/install.sh

  - name: vassal
    buildsystem: simple
    build-options:
      append-path: /usr/lib/sdk/openjdk21/bin
      env:
        MAVEN_OPTS: -Dmaven.repo.local=.m2/repository
    build-commands:
      - make release-linux
      - tar -xf tmp/VASSAL-*-linux.tar.bz2
      - mv VASSAL-*/lib /app
      - install -Dm644 -t /app/share/applications debian/vassal.desktop
      - install -Dm644 -t /app/share/icons/hicolor/scalable/apps VASSAL-*/VASSAL.svg
      - install -Dm644 -t /app/share/metainfo dist/linux/org.vassalengine.vassal.metainfo.xml
      - install -Dm755 -t /app/bin vassal
    sources:
      - type: git
        url: https://github.com/vassalengine/vassal.git
        commit: 0a9ea538b6a3d17f74b4f09ca607f4e355feb93f
        tag: 3.7.20
        x-checker-data:
          type: json
          url: https://api.github.com/repos/vassalengine/vassal/releases/latest
          tag-query: .tag_name
      - type: patch
        path: patches/use-system-mvn.patch
      - type: patch
        path: patches/skip-vassal-doc.patch
      - type: script
        dest-filename: vassal
        commands:
          - java -classpath /app/lib/Vengine.jar VASSAL.launch.ModuleManager "$@"
      - maven-dependencies.yml
